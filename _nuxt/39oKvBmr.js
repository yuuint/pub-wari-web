import{A as q,B as Y,D as z,G as F,K as G,d as n,u as Q,U as Z,b as x,c as P,w as i,e as E,W as tt,n as A,o as d,q as et,i as h,s as O,t as o,g as W,h as f,V as b,f as at,y as p,j as y,k as I,F as j,r as N,v as T,x as rt,P as J}from"./Bo5CoKcQ.js";import{S as st}from"./CSlFEJh2.js";import{V as nt,b as it,c as lt}from"./BHL3FXhg.js";const ot=q({start:Boolean,end:Boolean,...Y(),...z()},"VListItemMedia"),mt=F()({name:"VListItemMedia",props:ot(),setup(s,t){let{slots:e}=t;return G(()=>n(s.tag,{class:["v-list-item-media",{"v-list-item-media--start":s.start,"v-list-item-media--end":s.end},s.class],style:s.style},e)),{}}});var g={},v={},C={},c={},S={},_={},M={};Object.defineProperty(M,"__esModule",{value:!0});M.PayItem=void 0;class V{constructor(t){this.payItemMap=new Map,t.forEach(e=>{this.payItemMap.set(e,0)})}getItemAmount(t){var e;return this.hasItemTitle(t),(e=this.payItemMap.get(t))!==null&&e!==void 0?e:0}getTotalAmount(){let t=0;return this.payItemMap.forEach((e,a)=>{t+=e??0}),t}setItemAmount(t,e){this.hasItemTitle(t),this.payItemMap.set(t,e)}plusItemAmount(t,e){var a;this.hasItemTitle(t);let r=(a=this.payItemMap.get(t))!==null&&a!==void 0?a:0;this.payItemMap.set(t,r+e)}minusItemAmount(t,e){var a;this.hasItemTitle(t);let r=(a=this.payItemMap.get(t))!==null&&a!==void 0?a:0;this.payItemMap.set(t,r-e)}clearItemAmount(t){this.hasItemTitle(t),this.payItemMap.set(t,0)}clearAllItemAmount(){this.payItemMap.forEach((t,e)=>{this.payItemMap.set(e,0)})}hasItemTitle(t){if(!this.payItemMap.has(t))throw new Error("Items must always be defined at initialization time.");return!0}}M.PayItem=V;V.CR_ITEM_PREFIX="cr-";V.DR_ITEM_PREFIX="dr-";Object.defineProperty(_,"__esModule",{value:!0});_.PayCrItem=void 0;const K=M;class D extends K.PayItem{constructor(){super([D.SHUKIN])}}_.PayCrItem=D;D.SHUKIN=K.PayItem.CR_ITEM_PREFIX+"shukin";var k={};Object.defineProperty(k,"__esModule",{value:!0});k.PayDrItem=void 0;const X=M;class R extends X.PayItem{constructor(){super([R.TATEKAE])}}k.PayDrItem=R;R.TATEKAE=X.PayItem.DR_ITEM_PREFIX+"tatekae";Object.defineProperty(S,"__esModule",{value:!0});S.PayItemUtils=void 0;const ut=_,dt=k,$=M;class yt{constructor(){this.payCrItem=new ut.PayCrItem,this.payDrItem=new dt.PayDrItem}setPayCrItemInstance(t){this.payCrItem=t}setPayDrItemInstance(t){this.payDrItem=t}setPayItemInstace(t,e){this.payCrItem=t,this.payDrItem=e}clearTotalAmount(){this.payCrItem.clearAllItemAmount(),this.payDrItem.clearAllItemAmount()}getCrTotalAmount(){return this.payCrItem.getTotalAmount()}getDrTotalAmount(){return this.payDrItem.getTotalAmount()}getTotalAmount(){return this.getCrTotalAmount()+this.getDrTotalAmount()}addPayTrade(t,e){this.addPlusPayTrade(t,e)}addPlusPayTrade(t,e){this.getPayItemInstanceByItemTitle(t).plusItemAmount(t,e)}addMinusPayTrade(t,e){this.getPayItemInstanceByItemTitle(t).minusItemAmount(t,e)}getPayItemInstanceByItemTitle(t){switch(t.substring(0,3)){case $.PayItem.CR_ITEM_PREFIX:return this.payCrItem;case $.PayItem.DR_ITEM_PREFIX:return this.payDrItem;default:throw new Error("ItemTitle must be defined using the PREFIX defined for PayItem.")}}}S.PayItemUtils=yt;Object.defineProperty(c,"__esModule",{value:!0});c.MemberPayTask=c.MemberSplitResult=c.Member=void 0;const ct=S;class ht{constructor(t,e=""){this.id=t,this.name=e,this.payUtils=new ct.PayItemUtils}}c.Member=ht;class pt{getPayBalance(){return this.balance}addPayOutToTask(t,e){const a=new w(this.id,t.id,this.name,t.name,e,this.id);this.payTasks.push(a),this.balance+=e}addPayInFromTask(t,e){const a=new w(t.id,this.id,t.name,this.name,e,this.id);this.payTasks.push(a),this.balance-=e}constructor(t,e){this.totalCr=0,this.totalDr=0,this.totalAmount=0,this.balance=0,this.balanceInit=0,this.payAt=0,this.payTasks=new Array,this.id=t.id,this.name=t.name,this.totalCr=t.payUtils.getCrTotalAmount(),this.totalDr=t.payUtils.getDrTotalAmount(),this.totalAmount=t.payUtils.getTotalAmount(),this.balance=this.totalAmount+e,this.balanceInit=this.balance,this.payAt=e}}c.MemberSplitResult=pt;class w{constructor(t,e,a,r,l,m){this.fromId=t,this.fromName=a,this.toId=e,this.toName=r,this.amount=l,this.createAt=m,this.isPayOutTask=this.createAt===this.fromId,this.isPayInTask=this.createAt===this.toId}}c.MemberPayTask=w;Object.defineProperty(C,"__esModule",{value:!0});C.WarikanUtils=void 0;const It=c;class bt{static toSplitResultMap(t,e){let a=new Map;return t.forEach(r=>{let l=new It.MemberSplitResult(r,e);a.set(r.id,l)}),a}static toSplitResultArray(t){let e=new Array;return t.forEach(a=>{e.push(a)}),e}static basicSplit(t,e){let a=this.toSplitResultMap(t,e);return a.forEach(r=>{r.getPayBalance()>0||a.forEach(l=>{if(r.id!==l.id&&r.getPayBalance()<0&&l.getPayBalance()>0){const m=Math.floor(r.getPayBalance()*-1);r.getPayBalance()+l.getPayBalance()===0&&m&&(r.addPayOutToTask(l,m),l.addPayInFromTask(r,m))}})}),a.forEach(r=>{r.getPayBalance()>0||a.forEach(l=>{if(r.id!==l.id&&r.getPayBalance()<0&&l.getPayBalance()>0){let m=0;r.getPayBalance()+l.getPayBalance()<0?m=Math.floor(l.getPayBalance()):m=Math.floor(r.getPayBalance()*-1),m&&(r.addPayOutToTask(l,m),l.addPayInFromTask(r,m))}})}),this.toSplitResultArray(a)}}C.WarikanUtils=bt;Object.defineProperty(v,"__esModule",{value:!0});v.Warikan=void 0;const L=C;class Mt{constructor(){this.membersMap=new Map}addMember(t){this.membersMap.set(t.id,t)}addMembers(t){t.forEach(e=>{this.addMember(e)})}addPayTradeByMemberId(t,e,a){const r=this.getMember(t);if(r)r.payUtils.addPayTrade(e,a);else throw new Error("Members must be added in advance.")}addPlusPayTradeByMemberId(t,e,a){const r=this.getMember(t);if(r)r.payUtils.addPlusPayTrade(e,a);else throw new Error("Members must be added in advance.")}addMinusPayTradeByMemberId(t,e,a){const r=this.getMember(t);if(r)r.payUtils.addMinusPayTrade(e,a);else throw new Error("Members must be added in advance.")}removeMemberById(t){this.membersMap.has(t)&&this.membersMap.delete(t)}removeMember(t){this.removeMemberById(t.id)}getMembersTotalAmount(){let t=0;return this.membersMap.forEach(e=>{t+=e.payUtils.getTotalAmount()}),t}getMembersTotalCrAmount(){let t=0;return this.membersMap.forEach(e=>{t+=e.payUtils.getCrTotalAmount()}),t}getMemberCount(){return this.membersMap.size}getMembersDrAt(){var t;return this.getMemberCount()&&(t=this.getMembersTotalDrAmount()/this.getMemberCount())!==null&&t!==void 0?t:0}getMembersCrAt(){return this.getMemberCount()?this.getMembersTotalCrAmount()/this.getMemberCount():0}getMembersTotalDrAmount(){let t=0;return this.membersMap.forEach(e=>{t+=e.payUtils.getDrTotalAmount()}),t}getMember(t){return this.membersMap.get(t)}getMembersByMap(){return this.membersMap}getMembersByArray(){let t=[];return this.membersMap.forEach(e=>{t.push(e)}),t}getSplitResultsByArray(){return L.WarikanUtils.basicSplit(this.membersMap,this.getMembersDrAt()*-1)}getSplitResultsByMap(){let t=new Map;return L.WarikanUtils.basicSplit(this.membersMap,this.getMembersDrAt()*-1).forEach(a=>{t.set(a.id,a)}),t}}v.Warikan=Mt;(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.WarikanDrItem=s.WarikanCrItem=s.WarikanResult=s.WarikanMember=s.Warikan=void 0;const t=v;Object.defineProperty(s,"Warikan",{enumerable:!0,get:function(){return t.Warikan}});const e=c;Object.defineProperty(s,"WarikanMember",{enumerable:!0,get:function(){return e.Member}}),Object.defineProperty(s,"WarikanResult",{enumerable:!0,get:function(){return e.MemberSplitResult}});const a=_;Object.defineProperty(s,"WarikanCrItem",{enumerable:!0,get:function(){return a.PayCrItem}});const r=k;Object.defineProperty(s,"WarikanDrItem",{enumerable:!0,get:function(){return r.PayDrItem}})})(g);var H={},B={};Object.defineProperty(B,"__esModule",{value:!0});B.MomeyUtils=void 0;class Pt{static toJpString(t){return new Intl.NumberFormat("ja-JP",{style:"currency",currency:"JPY"}).format(t)}}B.MomeyUtils=Pt;Object.defineProperty(H,"__esModule",{value:!0});const ft=B;var u=H.default=ft.MomeyUtils;const gt={class:"ftext-ht1g text-center"},_t={class:"ftext-ht1 text-center"},kt={key:0},At={key:1},U=Q(),Tt=Z(),vt={components:{QRCodeVue3:st},async mounted(){this.roomId=Tt.params.id,this.roomData=await U.getRoom(this.roomId),this.roomTrans=await U.getRoomPayTransactions(this.roomId),this.roomMates=await U.getRoomMates(this.roomId),this.shareUrl="https://wari.ynetlabo.net/?joinroomid="+this.roomId;let s=new g.Warikan,t=[];this.roomMates.forEach(e=>{let a=new g.WarikanMember(e.id,e.memberName);t.push(a)}),s.addMembers(t),this.roomTrans.forEach(e=>{e.payType===tt.CREDIT?s.addPayTradeByMemberId(e.member,g.WarikanDrItem.TATEKAE,Number(e.value)):s.addPayTradeByMemberId(e.member,g.WarikanCrItem.SHUKIN,Number(e.value))}),s.getMemberCount()&&(this.payAt=s.getMembersCrAt(),this.dispPayAt=u.toJpString(this.payAt),this.payDrSum=s.getMembersTotalDrAmount(),this.payCrSum=s.getMembersTotalCrAmount(),this.payTranSum=s.getMembersTotalAmount()),this.warikanResult=s.getSplitResultsByArray(),this.loading=!1},data(){return{roomMates:[],roomData:null,shareUrl:void 0,roomId:null,loading:!0,roomMemberCnt:0,payTranSum:0,payDrSum:0,payCrSum:0,payAt:0,dispTranSum:0,dispDrSum:0,dispCrSum:0,dispPayAt:"-",warikanResult:[],paySumByMemberMap:new Map,headers:[{title:"日付",align:"start",sortable:!0,key:"date",minWidth:"5rem"},{title:"区分",align:"start",sortable:!0,key:"payType",minWidth:"3rem"},{title:"金額",align:"end",sortable:!1,key:"displayValue",minWidth:"5rem"},{title:"内容",align:"start",sortable:!0,key:"title",minWidth:"10rem"},{title:"メンバー",align:"start",sortable:!0,key:"memberName",minWidth:"8rem"},{title:"カテゴリ",align:"end",sortable:!0,key:"category",minWidth:"8rem"}],roomTrans:[],items:[{date:"2024/1/14",plusMinus:1,value:"¥-123,000",member:"優希",title:"sample titlaaaaaaaaaaaaaaaae",way:"建替",category:"宿泊代"}]}},methods:{handleBackBtnTap(){A("../dashboard")},handleSummaryBtnTap(){A("./list")},handleCrTrun(s){A({path:"./cr-tran",query:{member:s}})},handleDrTrun(s){A({path:"./dr-tran",query:{member:s}})},getPaysumVariant(s){return s!=0?"elevated":"tonal"}}},Rt=Object.assign(vt,{__name:"split",setup(s){return x({title:"ワリカン"}),(t,e)=>(d(),P("div",null,[n(E,null,{default:i(()=>[n(et,{onClick:t.handleBackBtnTap,color:"orange-darken-2","prepend-icon":"mdi-arrow-left",variant:"tonal"},{default:i(()=>[h("ルームに戻る")]),_:1},8,["onClick"])]),_:1}),n(E,null,{default:i(()=>{var a;return[O("div",gt,o((a=t.roomData)==null?void 0:a.roomName)+"の割り勘提案 ",1),n(W,null,{default:i(()=>[n(f,null,{default:i(()=>[n(b,{onClick:t.handleSummaryBtnTap,color:"blue-grey-lighten-1"},{default:i(()=>[n(at,null,{default:i(()=>[n(p,{icon:"mdi-calculator-variant-outline"}),h(o(y(u).toJpString(t.payTranSum)+"  ")+" ",1),O("div",_t," 1人あたり費用　"+o(t.dispPayAt),1)]),_:1}),n(I,null,{default:i(()=>[n(W,null,{default:i(()=>[n(f,{cols:"6"},{default:i(()=>[n(b,{variant:t.getPaysumVariant(t.payDrSum),color:"teal-darken-4"},{default:i(()=>[n(I,null,{default:i(()=>[n(p,{icon:"mdi-cash-plus"}),h(o(y(u).toJpString(t.payDrSum)),1)]),_:1})]),_:1},8,["variant"])]),_:1}),n(f,{cols:"6"},{default:i(()=>[n(b,{variant:t.getPaysumVariant(t.payCrSum),color:"yellow-darken-4"},{default:i(()=>[n(I,null,{default:i(()=>[n(p,{icon:"mdi-cash-minus"}),h(o(y(u).toJpString(t.payCrSum)),1)]),_:1})]),_:1},8,["variant"])]),_:1})]),_:1})]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1})]}),_:1}),n(E,null,{default:i(()=>[n(nt,{lines:"three"},{default:i(()=>[(d(!0),P(j,null,N(t.warikanResult,a=>(d(),T(it,{key:a.id,title:a.name},{prepend:i(()=>[n(rt,{color:"orange-darken-1",variant:"outlined"},{default:i(()=>[n(p,{icon:"mdi-account"})]),_:1})]),default:i(()=>[n(mt,null,{default:i(()=>[a.payTasks.length>0?(d(),P("div",kt,o(y(u).toJpString(Math.abs(a.balanceInit))+" ")+" "+o(a.balanceInit>0?"受け取ってください":"渡してください"),1)):(d(),P("div",At,o(y(u).toJpString(Math.abs(a.balanceInit))+" "),1)),(d(!0),P(j,null,N(a.payTasks,r=>(d(),T(b,{key:r,class:"ftext-ht1g",variant:"flat"},{default:i(()=>[r.isPayInTask?(d(),T(I,{key:0},{default:i(()=>[n(p,{icon:"mdi-account-arrow-left",color:"blue"}),h(" "+o(r.fromName+" から "+y(u).toJpString(r.amount)),1)]),_:2},1024)):J("",!0),r.isPayOutTask?(d(),T(I,{key:1},{default:i(()=>[n(p,{icon:"mdi-account-arrow-right",color:"red"}),h(" "+o(r.toName+" へ "+y(u).toJpString(r.amount)),1)]),_:2},1024)):J("",!0)]),_:2},1024))),128))]),_:2},1024),n(lt,null,{default:i(()=>[n(W,null,{default:i(()=>[n(f,{cols:"6"},{default:i(()=>[n(b,{variant:t.getPaysumVariant(a.totalDr),color:"teal-darken-4",onClick:r=>t.handleDrTrun(a.id)},{default:i(()=>[n(I,null,{default:i(()=>[n(p,{icon:"mdi-cash-plus"}),h(o(y(u).toJpString(a.totalDr)),1)]),_:2},1024)]),_:2},1032,["variant","onClick"])]),_:2},1024),n(f,{cols:"6"},{default:i(()=>[n(b,{variant:t.getPaysumVariant(a.totalCr),color:"yellow-darken-4",onClick:r=>t.handleCrTrun(a.id)},{default:i(()=>[n(I,null,{default:i(()=>[n(p,{icon:"mdi-cash-minus"}),h(o(y(u).toJpString(a.totalCr)),1)]),_:2},1024)]),_:2},1032,["variant","onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["title"]))),128))]),_:1})]),_:1})]))}});export{Rt as default};
