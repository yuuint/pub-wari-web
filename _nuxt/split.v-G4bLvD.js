import{A as q,B as z,D as Y,G as F,K as G,d as n,u as Q,U as Z,b as x,c as P,w as i,e as R,W as ee,n as A,o as d,q as te,i as h,s as O,t as o,g as W,h as f,V as b,f as ae,x as p,j as y,k as I,F as j,r as N,v as re,z as T,P as J}from"./entry.9wm2MXXQ.js";import{S as se}from"./index.es.eOzeECfp.js";import{V as ne,b as ie,c as le}from"./VList.TIruW2Jn.js";const oe=q({start:Boolean,end:Boolean,...z(),...Y()},"VListItemMedia"),me=F()({name:"VListItemMedia",props:oe(),setup(s,e){let{slots:t}=e;return G(()=>n(s.tag,{class:["v-list-item-media",{"v-list-item-media--start":s.start,"v-list-item-media--end":s.end},s.class],style:s.style},t)),{}}});var g={},v={},C={},c={},S={},_={},M={};Object.defineProperty(M,"__esModule",{value:!0});M.PayItem=void 0;class V{constructor(e){this.payItemMap=new Map,e.forEach(t=>{this.payItemMap.set(t,0)})}getItemAmount(e){var t;return this.hasItemTitle(e),(t=this.payItemMap.get(e))!==null&&t!==void 0?t:0}getTotalAmount(){let e=0;return this.payItemMap.forEach((t,a)=>{e+=t??0}),e}setItemAmount(e,t){this.hasItemTitle(e),this.payItemMap.set(e,t)}plusItemAmount(e,t){var a;this.hasItemTitle(e);let r=(a=this.payItemMap.get(e))!==null&&a!==void 0?a:0;this.payItemMap.set(e,r+t)}minusItemAmount(e,t){var a;this.hasItemTitle(e);let r=(a=this.payItemMap.get(e))!==null&&a!==void 0?a:0;this.payItemMap.set(e,r-t)}clearItemAmount(e){this.hasItemTitle(e),this.payItemMap.set(e,0)}clearAllItemAmount(){this.payItemMap.forEach((e,t)=>{})}hasItemTitle(e){if(!this.payItemMap.has(e))throw new Error("Items must always be defined at initialization time.");return!0}}M.PayItem=V;V.CR_ITEM_PREFIX="cr-";V.DR_ITEM_PREFIX="dr-";Object.defineProperty(_,"__esModule",{value:!0});_.PayCrItem=void 0;const K=M;class B extends K.PayItem{constructor(){super([B.SHUKIN])}}_.PayCrItem=B;B.SHUKIN=K.PayItem.CR_ITEM_PREFIX+"shukin";var k={};Object.defineProperty(k,"__esModule",{value:!0});k.PayDrItem=void 0;const X=M;class D extends X.PayItem{constructor(){super([D.TATEKAE])}}k.PayDrItem=D;D.TATEKAE=X.PayItem.DR_ITEM_PREFIX+"tatekae";Object.defineProperty(S,"__esModule",{value:!0});S.PayItemUtils=void 0;const ue=_,de=k,$=M;class ye{constructor(){this.payCrItem=new ue.PayCrItem,this.payDrItem=new de.PayDrItem}setPayCrItemInstance(e){this.payCrItem=e}setPayDrItemInstance(e){this.payDrItem=e}setPayItemInstace(e,t){this.payCrItem=e,this.payDrItem=t}clearTotalAmount(){this.payCrItem.clearAllItemAmount(),this.payDrItem.clearAllItemAmount()}getCrTotalAmount(){return this.payCrItem.getTotalAmount()}getDrTotalAmount(){return this.payDrItem.getTotalAmount()}getTotalAmount(){return this.getCrTotalAmount()+this.getDrTotalAmount()}addPayTrade(e,t){this.addPlusPayTrade(e,t)}addPlusPayTrade(e,t){this.getPayItemInstanceByItemTitle(e).plusItemAmount(e,t)}addMinusPayTrade(e,t){this.getPayItemInstanceByItemTitle(e).minusItemAmount(e,t)}getPayItemInstanceByItemTitle(e){switch(e.substring(0,3)){case $.PayItem.CR_ITEM_PREFIX:return this.payCrItem;case $.PayItem.DR_ITEM_PREFIX:return this.payDrItem;default:throw new Error("ItemTitle must be defined using the PREFIX defined for PayItem.")}}}S.PayItemUtils=ye;Object.defineProperty(c,"__esModule",{value:!0});c.MemberPayTask=c.MemberSplitResult=c.Member=void 0;const ce=S;class he{constructor(e,t=""){this.id=e,this.name=t,this.payUtils=new ce.PayItemUtils}}c.Member=he;class pe{getPayBalance(){return this.balance}addPayOutToTask(e,t){const a=new w(this.id,e.id,this.name,e.name,t,this.id);this.payTasks.push(a),this.balance+=t}addPayInFromTask(e,t){const a=new w(e.id,this.id,e.name,this.name,t,this.id);this.payTasks.push(a),this.balance-=t}constructor(e,t){this.totalCr=0,this.totalDr=0,this.totalAmount=0,this.balance=0,this.balanceInit=0,this.payAt=0,this.payTasks=new Array,this.id=e.id,this.name=e.name,this.totalCr=e.payUtils.getCrTotalAmount(),this.totalDr=e.payUtils.getDrTotalAmount(),this.totalAmount=e.payUtils.getTotalAmount(),this.balance=this.totalAmount+t,this.balanceInit=this.balance,this.payAt=t}}c.MemberSplitResult=pe;class w{constructor(e,t,a,r,l,m){this.fromId=e,this.fromName=a,this.toId=t,this.toName=r,this.amount=l,this.createAt=m,this.isPayOutTask=this.createAt===this.fromId,this.isPayInTask=this.createAt===this.toId}}c.MemberPayTask=w;Object.defineProperty(C,"__esModule",{value:!0});C.WarikanUtils=void 0;const Ie=c;class be{static toSplitResultMap(e,t){let a=new Map;return e.forEach(r=>{let l=new Ie.MemberSplitResult(r,t);a.set(r.id,l)}),a}static toSplitResultArray(e){let t=new Array;return e.forEach(a=>{t.push(a)}),t}static basicSplit(e,t){let a=this.toSplitResultMap(e,t);return a.forEach(r=>{r.getPayBalance()>0||a.forEach(l=>{if(r.id!==l.id&&r.getPayBalance()<0&&l.getPayBalance()>0){const m=Math.floor(r.getPayBalance()*-1);r.getPayBalance()+l.getPayBalance()===0&&m&&(r.addPayOutToTask(l,m),l.addPayInFromTask(r,m))}})}),a.forEach(r=>{r.getPayBalance()>0||a.forEach(l=>{if(r.id!==l.id&&r.getPayBalance()<0&&l.getPayBalance()>0){let m=0;r.getPayBalance()+l.getPayBalance()<0?m=Math.floor(l.getPayBalance()):m=Math.floor(r.getPayBalance()*-1),m&&(r.addPayOutToTask(l,m),l.addPayInFromTask(r,m))}})}),this.toSplitResultArray(a)}}C.WarikanUtils=be;Object.defineProperty(v,"__esModule",{value:!0});v.Warikan=void 0;const L=C;class Me{constructor(){this.membersMap=new Map}addMember(e){this.membersMap.set(e.id,e)}addMembers(e){e.forEach(t=>{this.addMember(t)})}addPayTradeByMemberId(e,t,a){const r=this.getMember(e);if(r)r.payUtils.addPayTrade(t,a);else throw new Error("Members must be added in advance.")}addPlusPayTradeByMemberId(e,t,a){const r=this.getMember(e);if(r)r.payUtils.addPlusPayTrade(t,a);else throw new Error("Members must be added in advance.")}addMinusPayTradeByMemberId(e,t,a){const r=this.getMember(e);if(r)r.payUtils.addMinusPayTrade(t,a);else throw new Error("Members must be added in advance.")}removeMemberById(e){this.membersMap.has(e)&&this.membersMap.delete(e)}removeMember(e){this.removeMemberById(e.id)}getMembersTotalAmount(){let e=0;return this.membersMap.forEach(t=>{e+=t.payUtils.getTotalAmount()}),e}getMembersTotalCrAmount(){let e=0;return this.membersMap.forEach(t=>{e+=t.payUtils.getCrTotalAmount()}),e}getMemberCount(){return this.membersMap.size}getMembersDrAt(){return this.getMembersTotalDrAmount()/this.getMemberCount()}getMembersCrAt(){return this.getMembersTotalCrAmount()/this.getMemberCount()}getMembersTotalDrAmount(){let e=0;return this.membersMap.forEach(t=>{e+=t.payUtils.getDrTotalAmount()}),e}getMember(e){return this.membersMap.get(e)}getMembersByMap(){return this.membersMap}getMembersByArray(){let e=[];return this.membersMap.forEach(t=>{e.push(t)}),e}getMembersByStringArray(){let e=[];return this.membersMap.forEach(t=>{e.push(t.id)}),e}getSplitResultsByArray(){return L.WarikanUtils.basicSplit(this.membersMap,this.getMembersCrAt()*-1)}getSplitResultsByMap(){let e=new Map;return L.WarikanUtils.basicSplit(this.membersMap,this.getMembersCrAt()*-1).forEach(a=>{e.set(a.id,a)}),e}}v.Warikan=Me;(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.WarikanDrItem=s.WarikanCrItem=s.WarikanResult=s.WarikanMember=s.Warikan=void 0;const e=v;Object.defineProperty(s,"Warikan",{enumerable:!0,get:function(){return e.Warikan}});const t=c;Object.defineProperty(s,"WarikanMember",{enumerable:!0,get:function(){return t.Member}}),Object.defineProperty(s,"WarikanResult",{enumerable:!0,get:function(){return t.MemberSplitResult}});const a=_;Object.defineProperty(s,"WarikanCrItem",{enumerable:!0,get:function(){return a.PayCrItem}});const r=k;Object.defineProperty(s,"WarikanDrItem",{enumerable:!0,get:function(){return r.PayDrItem}})})(g);var H={},E={};Object.defineProperty(E,"__esModule",{value:!0});E.MomeyUtils=void 0;class Pe{static toJpString(e){return new Intl.NumberFormat("ja-JP",{style:"currency",currency:"JPY"}).format(e)}}E.MomeyUtils=Pe;Object.defineProperty(H,"__esModule",{value:!0});const fe=E;var u=H.default=fe.MomeyUtils;const ge={class:"ftext-ht1g text-center"},_e={class:"ftext-ht1 text-center"},ke={key:0},Ae={key:1},U=Q(),Te=Z(),ve={components:{QRCodeVue3:se},async mounted(){this.roomId=Te.params.id,this.roomData=await U.getRoom(this.roomId),this.roomTrans=await U.getRoomPayTransactions(this.roomId),this.roomMates=await U.getRoomMates(this.roomId),this.shareUrl="https://wari.ynetlabo.net/?joinroomid="+this.roomId;let s=new g.Warikan,e=[];this.roomMates.forEach(t=>{let a=new g.WarikanMember(t.id,t.memberName);e.push(a)}),s.addMembers(e),this.roomTrans.forEach(t=>{t.payType===ee.CREDIT?s.addPayTradeByMemberId(t.member,g.WarikanCrItem.SHUKIN,Number(t.value)):s.addPayTradeByMemberId(t.member,g.WarikanDrItem.TATEKAE,Number(t.value))}),s.getMemberCount()&&(this.payAt=s.getMembersCrAt(),this.dispPayAt=u.toJpString(this.payAt),this.payDrSum=s.getMembersTotalDrAmount(),this.payCrSum=s.getMembersTotalCrAmount(),this.payTranSum=s.getMembersTotalAmount()),this.warikanResult=s.getSplitResultsByArray(),this.loading=!1},data(){return{roomMates:[],roomData:null,shareUrl:void 0,roomId:null,loading:!0,roomMemberCnt:0,payTranSum:0,payDrSum:0,payCrSum:0,payAt:0,dispTranSum:0,dispDrSum:0,dispCrSum:0,dispPayAt:"-",warikanResult:[],paySumByMemberMap:new Map,headers:[{title:"日付",align:"start",sortable:!0,key:"date",minWidth:"5rem"},{title:"区分",align:"start",sortable:!0,key:"payType",minWidth:"3rem"},{title:"金額",align:"end",sortable:!1,key:"displayValue",minWidth:"5rem"},{title:"内容",align:"start",sortable:!0,key:"title",minWidth:"10rem"},{title:"メンバー",align:"start",sortable:!0,key:"memberName",minWidth:"8rem"},{title:"カテゴリ",align:"end",sortable:!0,key:"category",minWidth:"8rem"}],roomTrans:[],items:[{date:"2024/1/14",plusMinus:1,value:"¥-123,000",member:"優希",title:"sample titlaaaaaaaaaaaaaaaae",way:"建替",category:"宿泊代"}]}},methods:{handleBackBtnTap(){A("../dashboard")},handleSummaryBtnTap(){A("./list")},handleCrTrun(s){A({path:"./cr-tran",query:{member:s}})},handleDrTrun(s){A({path:"./dr-tran",query:{member:s}})},getPaysumVariant(s){return s!=0?"elevated":"tonal"}}},De=Object.assign(ve,{__name:"split",setup(s){return x({title:"ワリカン"}),(e,t)=>(d(),P("div",null,[n(R,null,{default:i(()=>[n(te,{onClick:e.handleBackBtnTap,color:"orange-darken-2","prepend-icon":"mdi-arrow-left",variant:"tonal"},{default:i(()=>[h("ルームに戻る")]),_:1},8,["onClick"])]),_:1}),n(R,null,{default:i(()=>{var a;return[O("div",ge,o((a=e.roomData)==null?void 0:a.roomName)+"の割り勘提案 ",1),n(W,null,{default:i(()=>[n(f,null,{default:i(()=>[n(b,{onClick:e.handleSummaryBtnTap,color:"blue-grey-lighten-1"},{default:i(()=>[n(ae,null,{default:i(()=>[n(p,{icon:"mdi-calculator-variant-outline"}),h(o(y(u).toJpString(e.payTranSum)+"  ")+" ",1),O("div",_e," 1人あたり費用　"+o(e.dispPayAt),1)]),_:1}),n(I,null,{default:i(()=>[n(W,null,{default:i(()=>[n(f,{cols:"6"},{default:i(()=>[n(b,{variant:e.getPaysumVariant(e.payDrSum),color:"teal-darken-4"},{default:i(()=>[n(I,null,{default:i(()=>[n(p,{icon:"mdi-cash-plus"}),h(o(y(u).toJpString(e.payDrSum)),1)]),_:1})]),_:1},8,["variant"])]),_:1}),n(f,{cols:"6"},{default:i(()=>[n(b,{variant:e.getPaysumVariant(e.payCrSum),color:"yellow-darken-4"},{default:i(()=>[n(I,null,{default:i(()=>[n(p,{icon:"mdi-cash-minus"}),h(o(y(u).toJpString(e.payCrSum)),1)]),_:1})]),_:1},8,["variant"])]),_:1})]),_:1})]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1})]}),_:1}),n(R,null,{default:i(()=>[n(ne,{lines:"three"},{default:i(()=>[(d(!0),P(j,null,N(e.warikanResult,a=>(d(),T(ie,{key:a.id,title:a.name},{prepend:i(()=>[n(re,{color:"orange-darken-1",variant:"outlined"},{default:i(()=>[n(p,{icon:"mdi-account"})]),_:1})]),default:i(()=>[n(me,null,{default:i(()=>[a.payTasks.length>0?(d(),P("div",ke,o(y(u).toJpString(Math.abs(a.balanceInit))+" ")+" "+o(a.balanceInit>0?"受け取ってください":"渡してください"),1)):(d(),P("div",Ae,o(y(u).toJpString(Math.abs(a.balanceInit))+" "),1)),(d(!0),P(j,null,N(a.payTasks,r=>(d(),T(b,{key:r,class:"ftext-ht1g",variant:"flat"},{default:i(()=>[r.isPayInTask?(d(),T(I,{key:0},{default:i(()=>[n(p,{icon:"mdi-account-arrow-left",color:"blue"}),h(" "+o(r.fromName+" から "+y(u).toJpString(r.amount)),1)]),_:2},1024)):J("",!0),r.isPayOutTask?(d(),T(I,{key:1},{default:i(()=>[n(p,{icon:"mdi-account-arrow-right",color:"red"}),h(" "+o(r.toName+" へ "+y(u).toJpString(r.amount)),1)]),_:2},1024)):J("",!0)]),_:2},1024))),128))]),_:2},1024),n(le,null,{default:i(()=>[n(W,null,{default:i(()=>[n(f,{cols:"6"},{default:i(()=>[n(b,{variant:e.getPaysumVariant(a.totalDr),color:"teal-darken-4",onClick:r=>e.handleDrTrun(a.id)},{default:i(()=>[n(I,null,{default:i(()=>[n(p,{icon:"mdi-cash-plus"}),h(o(y(u).toJpString(a.totalDr)),1)]),_:2},1024)]),_:2},1032,["variant","onClick"])]),_:2},1024),n(f,{cols:"6"},{default:i(()=>[n(b,{variant:e.getPaysumVariant(a.totalCr),color:"yellow-darken-4",onClick:r=>e.handleCrTrun(a.id)},{default:i(()=>[n(I,null,{default:i(()=>[n(p,{icon:"mdi-cash-minus"}),h(o(y(u).toJpString(a.totalCr)),1)]),_:2},1024)]),_:2},1032,["variant","onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["title"]))),128))]),_:1})]),_:1})]))}});export{De as default};
